export type PromptRegressionFlow =
  | 'topic_identification'
  | 'quiz_helppo'
  | 'quiz_normaali'
  | 'flashcard_vocabulary'
  | 'flashcard_grammar';

export interface PromptQualityRubric {
  schemaAdherence: number;
  topicQuality: number;
  pedagogicalQuality: number;
  languageQuality: number;
}

export interface PromptRegressionSample {
  promptVersion: 'baseline_pre_refactor' | 'refactored_provider_neutral';
  output: string;
  rubric: PromptQualityRubric;
  notes: string;
}

export interface ProviderPromptRegressionPair {
  baseline: PromptRegressionSample;
  refactored: PromptRegressionSample;
}

export interface PromptRegressionScenario {
  id: string;
  flow: PromptRegressionFlow;
  subject: string;
  grade: 4 | 5 | 6;
  material: string;
  expectedQualitativeOutcomes: string[];
  providers: {
    anthropic: ProviderPromptRegressionPair;
    openai: ProviderPromptRegressionPair;
  };
}

const toJson = (value: unknown): string => JSON.stringify(value);

export const promptRegressionScenarios: PromptRegressionScenario[] = [
  {
    id: 'topic-math-grade6',
    flow: 'topic_identification',
    subject: 'matematiikka',
    grade: 6,
    material: 'Kolmiot, kulmien summa, suorakulmainen kolmio, Pythagoraan lause, pinta-ala.',
    expectedQualitativeOutcomes: [
      'topics cover geometry and pythagorean theorem',
      'topic names are in finnish and age-appropriate',
      'coverage values sum near 1.0',
    ],
    providers: {
      anthropic: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson({
            topics: [
              {
                name: 'Geometria',
                coverage: 0.4,
                difficulty: 'normaali',
                keywords: ['kolmio', 'kulmat', 'mittaaminen'],
                subtopics: ['Kulmien summa', 'Kolmion luokittelu'],
                importance: 'high',
              },
              {
                name: 'Pythagoraan lause',
                coverage: 0.35,
                difficulty: 'normaali',
                keywords: ['suorakulmainen kolmio', 'hypotenuusa', 'laskeminen'],
                subtopics: ['Lauseen soveltaminen', 'Sivun pituus'],
                importance: 'high',
              },
              {
                name: 'Pinta-ala',
                coverage: 0.25,
                difficulty: 'helppo',
                keywords: ['kaava', 'suorakulmio', 'kolmio'],
                subtopics: ['Suorakulmion pinta-ala', 'Kolmion pinta-ala'],
                importance: 'medium',
              },
            ],
            metadata: {
              totalConcepts: 9,
              estimatedDifficulty: 'normaali',
              completeness: 0.88,
              materialType: 'textbook',
            },
          }),
          rubric: {
            schemaAdherence: 4.7,
            topicQuality: 4.7,
            pedagogicalQuality: 4.6,
            languageQuality: 4.8,
          },
          notes: 'Strong topic fit, one subtopic could be more specific for grade 6 practice.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson({
            topics: [
              {
                name: 'Geometria ja kulmat',
                coverage: 0.36,
                difficulty: 'normaali',
                keywords: ['kolmiot', 'kulmien summa', 'aste'],
                subtopics: ['Kulmien summa', 'Kolmion kulmat'],
                importance: 'high',
              },
              {
                name: 'Pythagoraan lause',
                coverage: 0.34,
                difficulty: 'normaali',
                keywords: ['suorakulmainen kolmio', 'sivut', 'hypotenuusa'],
                subtopics: ['Lauseen idea', 'Sivun laskeminen'],
                importance: 'high',
              },
              {
                name: 'Pinta-ala ja kaavat',
                coverage: 0.3,
                difficulty: 'helppo',
                keywords: ['pinta-ala', 'kaava', 'mittaaminen'],
                subtopics: ['Suorakulmio', 'Kolmio'],
                importance: 'medium',
              },
            ],
            metadata: {
              totalConcepts: 10,
              estimatedDifficulty: 'normaali',
              completeness: 0.9,
              materialType: 'textbook',
            },
          }),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.8,
            pedagogicalQuality: 4.7,
            languageQuality: 4.8,
          },
          notes: 'Coverage and naming are slightly more balanced with compact instruction style.',
        },
      },
      openai: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson({
            topics: [
              {
                name: 'Geometria',
                coverage: 0.45,
                difficulty: 'normaali',
                keywords: ['kolmiot', 'kulmat', 'asteet'],
                subtopics: ['Kolmion kulmat', 'Kulmien laskeminen'],
                importance: 'high',
              },
              {
                name: 'Pythagoraan lause',
                coverage: 0.3,
                difficulty: 'normaali',
                keywords: ['suorakulmainen kolmio', 'sivujen pituus', 'neliot'],
                subtopics: ['Lause', 'Tehtavat'],
                importance: 'high',
              },
              {
                name: 'Pinta-ala',
                coverage: 0.25,
                difficulty: 'helppo',
                keywords: ['kaava', 'suorakulmio', 'kolmio'],
                subtopics: ['Suorakulmio', 'Kolmio'],
                importance: 'medium',
              },
            ],
            metadata: {
              totalConcepts: 8,
              estimatedDifficulty: 'normaali',
              completeness: 0.85,
              materialType: 'textbook',
            },
          }),
          rubric: {
            schemaAdherence: 4.5,
            topicQuality: 4.5,
            pedagogicalQuality: 4.4,
            languageQuality: 4.6,
          },
          notes: 'Valid and usable output, slightly broader geometry bucket than expected.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson({
            topics: [
              {
                name: 'Kolmiot ja kulmat',
                coverage: 0.34,
                difficulty: 'normaali',
                keywords: ['kolmio', 'kulma', 'aste'],
                subtopics: ['Kulmien summa', 'Kolmion kulmat'],
                importance: 'high',
              },
              {
                name: 'Pythagoraan lause',
                coverage: 0.33,
                difficulty: 'normaali',
                keywords: ['suorakulmainen kolmio', 'hypotenuusa', 'lasku'],
                subtopics: ['Lauseen soveltaminen', 'Sivun pituus'],
                importance: 'high',
              },
              {
                name: 'Pinta-alat',
                coverage: 0.33,
                difficulty: 'helppo',
                keywords: ['pinta-ala', 'kaava', 'mitta'],
                subtopics: ['Suorakulmio', 'Kolmio'],
                importance: 'medium',
              },
            ],
            metadata: {
              totalConcepts: 9,
              estimatedDifficulty: 'normaali',
              completeness: 0.89,
              materialType: 'textbook',
            },
          }),
          rubric: {
            schemaAdherence: 4.8,
            topicQuality: 4.7,
            pedagogicalQuality: 4.6,
            languageQuality: 4.7,
          },
          notes: 'Refactored output improved topic balance and terminology consistency.',
        },
      },
    },
  },
  {
    id: 'quiz-finnish-grade5-helppo',
    flow: 'quiz_helppo',
    subject: 'suomen_kieli',
    grade: 5,
    material: 'Lauseen jasenet: subjekti, predikaatti, objekti. Esimerkkilauseet.',
    expectedQualitativeOutcomes: [
      'questions test sentence member recognition',
      'explanations mention why answer is correct and a common mistake',
      'wording stays clear for grade 5',
    ],
    providers: {
      anthropic: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mika on predikaatti lauseessa "Koira juoksee nopeasti"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              options: ['Koira', 'juoksee', 'nopeasti', 'on'],
              correct_answer: 'juoksee',
              explanation: 'Predikaatti kertoo tekemisen. Yleinen virhe on valita subjekti, joka kertoo tekijan.',
            },
            {
              question: 'Mika on subjekti lauseessa "Poika lukee kirjaa"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Subjekti',
              options: ['Poika', 'lukee', 'kirjaa', 'on'],
              correct_answer: 'Poika',
              explanation: 'Subjekti kertoo kuka tekee. Virhe on valita predikaatti eli tekemisen sana.',
            },
            {
              question: 'Mika on objekti lauseessa "Ella syo omenan"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Objekti',
              options: ['Ella', 'syo', 'omenan', 'on'],
              correct_answer: 'omenan',
              explanation: 'Objekti on tekemisen kohde. Se liittyy verbiin ja vastaa kysymykseen mita.',
            },
            {
              question: 'Valitse predikaatti lauseesta "Linnut lentavat".',
              type: 'short_answer',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              correct_answer: 'lentavat',
              explanation: 'Predikaatti kertoo tekemisen. Helppo tapa on etsia verbi.',
            },
            {
              question: 'Mika on predikaatti?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              options: ['tekija', 'tekeminen'],
              correct_answer: 'tekeminen',
              explanation: 'Liian lyhyt',
            },
          ]),
          rubric: {
            schemaAdherence: 4.0,
            topicQuality: 4.6,
            pedagogicalQuality: 4.5,
            languageQuality: 4.7,
          },
          notes: 'One explanation is too short for schema requirements; content quality otherwise high.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mika on predikaatti lauseessa "Koira juoksee nopeasti"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              options: ['Koira', 'juoksee', 'nopeasti', 'on'],
              correct_answer: 'juoksee',
              explanation: 'Predikaatti kertoo mita tehdaan, joten "juoksee" on oikein. Yleinen virhe on valita subjekti eli tekija.',
            },
            {
              question: 'Mika on objekti lauseessa "Ella syo omenan"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Objekti',
              options: ['Ella', 'syo', 'omenan', 'ja'],
              correct_answer: 'omenan',
              explanation: 'Objekti kertoo tekemisen kohteen. Se vastaa usein kysymykseen mita tai kenet.',
            },
            {
              question: 'Kirjoita lauseen "Poika lukee kirjaa" subjekti.',
              type: 'short_answer',
              topic: 'Lauseen jasenet',
              subtopic: 'Subjekti',
              correct_answer: 'Poika',
              explanation: 'Subjekti kertoo kuka tekee. Predikaatti taas kertoo tekemisen, joten niita ei pidata sekoittaa.',
            },
            {
              question: 'Mika on predikaatti lauseessa "Linnut lentavat korkealla"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              options: ['Linnut', 'lentavat', 'korkealla', 'Linnut lentavat'],
              correct_answer: 'lentavat',
              explanation: 'Predikaatti on verbi, joka ilmaisee tekemisen. "Lentavat" kertoo toiminnan.',
            },
            {
              question: 'Mika on subjekti lauseessa "Opettaja kysyy kysymyksen"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Subjekti',
              options: ['Opettaja', 'kysyy', 'kysymyksen', 'luokassa'],
              correct_answer: 'Opettaja',
              explanation: 'Subjekti on tekija. Yleinen virhe on valita objekti, joka on tekemisen kohde.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.7,
            pedagogicalQuality: 4.7,
            languageQuality: 4.8,
          },
          notes: 'All questions keep contract and explanations are pedagogically complete.',
        },
      },
      openai: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mika sana on predikaatti lauseessa "Koira juoksee nopeasti"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              options: ['Koira', 'juoksee', 'nopeasti', 'koira juoksee'],
              correct_answer: 'juoksee',
              explanation: 'Predikaatti on tekemista kuvaava verbi.',
            },
            {
              question: 'Mika on subjekti lauseessa "Poika lukee kirjaa"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Subjekti',
              options: ['Poika', 'lukee', 'kirjaa', 'kirja'],
              correct_answer: 'Poika',
              explanation: 'Subjekti on tekija lauseessa. Predikaatti kertoo tekemisen.',
            },
            {
              question: 'Mika on objekti lauseessa "Ella syo omenan"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Objekti',
              options: ['Ella', 'syo', 'omenan', 'on'],
              correct_answer: 'omenan',
              explanation: 'Objekti on se, mihin tekeminen kohdistuu.',
            },
            {
              question: 'Valitse predikaatti lauseesta "Linnut lentavat".',
              type: 'short_answer',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              correct_answer: 'lentavat',
              explanation: 'Predikaatti on verbi lauseessa.',
            },
            {
              question: 'Mika on subjekti lauseessa "Aino kirjoittaa vihkoon"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Subjekti',
              options: ['Aino', 'kirjoittaa', 'vihkoon', 'vihko'],
              correct_answer: 'Aino',
              explanation: 'Subjekti kertoo kuka tekee.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.8,
            topicQuality: 4.5,
            pedagogicalQuality: 4.4,
            languageQuality: 4.5,
          },
          notes: 'Valid structure, explanations are shorter and less instructional than baseline Claude.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mika on predikaatti lauseessa "Koira juoksee nopeasti"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              options: ['Koira', 'juoksee', 'nopeasti', 'juoksee nopeasti'],
              correct_answer: 'juoksee',
              explanation: 'Predikaatti kertoo tekemisen, joten "juoksee" on oikein. Virhe on valita subjekti eli tekija.',
            },
            {
              question: 'Mika on subjekti lauseessa "Poika lukee kirjaa"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Subjekti',
              options: ['Poika', 'lukee', 'kirjaa', 'kirjaan'],
              correct_answer: 'Poika',
              explanation: 'Subjekti kertoo kuka tekee teon. Predikaatti kertoo mita tehdaan.',
            },
            {
              question: 'Mika on objekti lauseessa "Ella syo omenan"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Objekti',
              options: ['Ella', 'syo', 'omenan', 'on'],
              correct_answer: 'omenan',
              explanation: 'Objekti on tekemisen kohde. Se vastaa usein kysymykseen mita.',
            },
            {
              question: 'Kirjoita predikaatti lauseesta "Linnut lentavat".',
              type: 'short_answer',
              topic: 'Lauseen jasenet',
              subtopic: 'Predikaatti',
              correct_answer: 'lentavat',
              explanation: 'Predikaatti on verbi, joka ilmaisee tekemisen. Tassa se on "lentavat".',
            },
            {
              question: 'Mika on subjekti lauseessa "Aino kirjoittaa vihkoon"?',
              type: 'multiple_choice',
              topic: 'Lauseen jasenet',
              subtopic: 'Subjekti',
              options: ['Aino', 'kirjoittaa', 'vihkoon', 'vihko'],
              correct_answer: 'Aino',
              explanation: 'Subjekti kertoo tekijan. Objekti olisi tekemisen kohde, ei tekija.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.6,
            pedagogicalQuality: 4.6,
            languageQuality: 4.7,
          },
          notes: 'Refactored prompt improves explanation consistency while keeping output contract.',
        },
      },
    },
  },
  {
    id: 'quiz-history-grade6-normaali',
    flow: 'quiz_normaali',
    subject: 'historia',
    grade: 6,
    material: 'Suomen itsenaistyminen, 1917 tapahtumat, yhteiskunnallinen muutos.',
    expectedQualitativeOutcomes: [
      'questions connect key dates to historical reasoning',
      'distractors remain plausible but grade-appropriate',
      'explanations reinforce cause and consequence',
    ],
    providers: {
      anthropic: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mina vuonna Suomi julistautui itsenaiseksi?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Vuosi 1917',
              options: ['1905', '1917', '1939', '1945'],
              correct_answer: '1917',
              explanation: 'Suomi julistautui itsenaiseksi vuonna 1917. Se liittyy Venajan vallankumouksen aiheuttamaan tilanteeseen.',
            },
            {
              question: 'Miksi Venajan vallankumous vaikutti Suomen tilanteeseen?',
              type: 'short_answer',
              topic: 'Itsenaistyminen',
              subtopic: 'Taustatekijat',
              correct_answer: 'Venajan valta heikkeni',
              explanation: 'Venajan valta heikkeni vallankumouksessa, joten Suomella oli mahdollisuus edeta itsenaisyyteen.',
            },
            {
              question: 'Mika paiva oli itsenaisyysjulistus?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Keskeiset paivamaarat',
              options: ['6.12.1917', '1.1.1918', '6.12.1918', '31.12.1917'],
              correct_answer: '6.12.1917',
              explanation: 'Itsenaisyysjulistus annettiin 6.12.1917, jota juhlimme itsenaisyyspaivana.',
            },
            {
              question: 'Valitse oikea vaite: itsenaistyminen tapahtui ilman mitaan taustatekijoita.',
              type: 'true_false',
              topic: 'Itsenaistyminen',
              subtopic: 'Syy-seuraus',
              correct_answer: false,
              explanation: 'Vaite on vaarin, koska taustalla oli useita yhteiskunnallisia muutoksia.',
            },
            {
              question: 'Mika vuosi?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Vuosi 1917',
              options: ['1917', '1918'],
              correct_answer: '1917',
              explanation: 'Liian lyhyt',
            },
          ]),
          rubric: {
            schemaAdherence: 4.0,
            topicQuality: 4.6,
            pedagogicalQuality: 4.6,
            languageQuality: 4.7,
          },
          notes: 'One output item fails explanation minimum but content intent remains aligned.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mina vuonna Suomi julistautui itsenaiseksi?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Vuosi 1917',
              options: ['1905', '1917', '1939', '1945'],
              correct_answer: '1917',
              explanation: 'Suomi julistautui itsenaiseksi vuonna 1917. Yleinen virhe on sekoittaa vuosi talvisotaan 1939.',
            },
            {
              question: 'Miksi Venajan vallankumous auttoi Suomen itsenaistymista?',
              type: 'short_answer',
              topic: 'Itsenaistyminen',
              subtopic: 'Taustatekijat',
              correct_answer: 'Venajan valta heikkeni',
              explanation: 'Kun Venajan valta heikkeni, Suomella oli enemman liikkumatilaa. Syy ja seuraus ovat historian perusidea.',
            },
            {
              question: 'Mika paivamaara liittyy Suomen itsenaisyyteen?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Keskeiset paivamaarat',
              options: ['6.12.1917', '1.1.1918', '6.12.1918', '31.12.1917'],
              correct_answer: '6.12.1917',
              explanation: 'Itsenaisyysjulistus annettiin 6.12.1917. Paiva muistetaan vuosittain itsenaisyyspaivana.',
            },
            {
              question: 'Totta vai tarua: Suomen itsenaistyminen tapahtui ilman kansainvalisia muutoksia.',
              type: 'true_false',
              topic: 'Itsenaistyminen',
              subtopic: 'Syy-seuraus',
              correct_answer: false,
              explanation: 'Tarua. Kansainvalinen tilanne ja Venajan vallankumous vaikuttivat ratkaisevasti.',
            },
            {
              question: 'Mika teki vuodesta 1917 merkittavan Suomessa?',
              type: 'short_answer',
              topic: 'Itsenaistyminen',
              subtopic: 'Keskeinen tapahtuma',
              correct_answer: 'Suomi julistautui itsenaiseksi',
              explanation: 'Vuonna 1917 Suomi julistautui itsenaiseksi. Se oli seurausta poliittisesta muutoksesta ja pitkasta kehityksesta.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.8,
            pedagogicalQuality: 4.8,
            languageQuality: 4.8,
          },
          notes: 'Refactored variant improves consistency and historical reasoning cues.',
        },
      },
      openai: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mina vuonna Suomi itsenaistyi?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Vuosi 1917',
              options: ['1917', '1918', '1939', '1940'],
              correct_answer: '1917',
              explanation: 'Suomi itsenaistyi vuonna 1917.',
            },
            {
              question: 'Miksi Venajan vallankumous vaikutti Suomeen?',
              type: 'short_answer',
              topic: 'Itsenaistyminen',
              subtopic: 'Taustatekijat',
              correct_answer: 'Venajan valta heikkeni',
              explanation: 'Valta heikkeni, joten Suomi pystyi etenemaan.',
            },
            {
              question: 'Mika paiva liittyy itsenaisyyteen?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Keskeiset paivamaarat',
              options: ['6.12.1917', '7.12.1917', '6.12.1918', '1.1.1917'],
              correct_answer: '6.12.1917',
              explanation: 'Itsenaisyyspaiva on 6.12.',
            },
            {
              question: 'Totta vai tarua: Suomen itsenaistyminen oli irrallinen tapahtuma.',
              type: 'true_false',
              topic: 'Itsenaistyminen',
              subtopic: 'Syy-seuraus',
              correct_answer: false,
              explanation: 'Tarua, koska taustalla oli poliittisia muutoksia.',
            },
            {
              question: 'Mika tapahtui vuonna 1917 Suomessa?',
              type: 'short_answer',
              topic: 'Itsenaistyminen',
              subtopic: 'Keskeinen tapahtuma',
              correct_answer: 'Suomi julistautui itsenaiseksi',
              explanation: 'Vuonna 1917 Suomi julistautui itsenaiseksi.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.5,
            pedagogicalQuality: 4.4,
            languageQuality: 4.6,
          },
          notes: 'Contract-valid but explanations are short and less guided.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mina vuonna Suomi julistautui itsenaiseksi?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Vuosi 1917',
              options: ['1905', '1917', '1939', '1945'],
              correct_answer: '1917',
              explanation: 'Oikea vastaus on 1917. Yleinen virhe on sekoittaa vuosi myohempiin sotiin.',
            },
            {
              question: 'Miksi Venajan vallankumous oli Suomelle merkittava?',
              type: 'short_answer',
              topic: 'Itsenaistyminen',
              subtopic: 'Taustatekijat',
              correct_answer: 'Venajan valta heikkeni',
              explanation: 'Vallankumous heikensi Venajan valtaa, joten Suomi pystyi etenemaan itsenaistymisessa.',
            },
            {
              question: 'Mika paivamaara on Suomen itsenaisyyspaiva?',
              type: 'multiple_choice',
              topic: 'Itsenaistyminen',
              subtopic: 'Keskeiset paivamaarat',
              options: ['6.12.1917', '1.1.1918', '6.1.1917', '31.12.1917'],
              correct_answer: '6.12.1917',
              explanation: 'Itsenaisyysjulistus annettiin 6.12.1917. Siksi paivaa juhlitaan vuosittain.',
            },
            {
              question: 'Totta vai tarua: Suomen itsenaistyminen tapahtui ilman yhteiskunnallista muutosta.',
              type: 'true_false',
              topic: 'Itsenaistyminen',
              subtopic: 'Syy-seuraus',
              correct_answer: false,
              explanation: 'Tarua. Taustalla oli useita poliittisia ja yhteiskunnallisia muutoksia.',
            },
            {
              question: 'Mika teki vuodesta 1917 historiallisesti tarkean Suomessa?',
              type: 'short_answer',
              topic: 'Itsenaistyminen',
              subtopic: 'Keskeinen tapahtuma',
              correct_answer: 'Suomi julistautui itsenaiseksi',
              explanation: 'Vuosi 1917 toi Suomelle itsenaisyyden. Tapahtuma liittyi laajaan kansainvaliseen muutokseen.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.7,
            pedagogicalQuality: 4.7,
            languageQuality: 4.7,
          },
          notes: 'Refactored prompt clearly improves pedagogical explanation depth.',
        },
      },
    },
  },
  {
    id: 'flashcard-english-grade4-vocabulary',
    flow: 'flashcard_vocabulary',
    subject: 'englanti',
    grade: 4,
    material: 'School vocabulary: desk, chair, book, pencil, eraser. Everyday greetings.',
    expectedQualitativeOutcomes: [
      'direct recall Q/A format without passive recognition patterns',
      'simple finnish support language for grade 4',
      'vocabulary focus remains concrete and classroom-relevant',
    ],
    providers: {
      anthropic: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mika on "book" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kirja',
              explanation: 'Book tarkoittaa kirjaa. Yleinen virhe on sekoittaa sana notebook-sanaan.',
            },
            {
              question: 'Mika on "chair" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'tuoli',
              explanation: 'Chair tarkoittaa tuolia. Sanaa kaytetaan luokassa usein.',
            },
            {
              question: 'Mika on "desk" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'pulpetti',
              explanation: 'Desk on pulpetti. Se liittyy koulun perussanastoon.',
            },
            {
              question: 'Mika sana tarkoittaa pyyhekumia?',
              type: 'multiple_choice',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              options: ['eraser', 'book'],
              correct_answer: 'eraser',
              explanation: 'Eraser tarkoittaa pyyhekumia.',
            },
            {
              question: 'Mika on "pencil" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kyna',
              explanation: 'Pencil on kyna. Muista erottaa se sanasta pen.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.2,
            topicQuality: 4.5,
            pedagogicalQuality: 4.4,
            languageQuality: 4.7,
          },
          notes: 'One non-flashcard item weakens strict format reliability.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mika on "book" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kirja',
              explanation: 'Book tarkoittaa kirjaa. Yleinen virhe on sekoittaa se vihkoa tarkoittavaan sanaan notebook.',
            },
            {
              question: 'Mika on "chair" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'tuoli',
              explanation: 'Chair tarkoittaa tuolia. Sana kuuluu luokan perussanastoon.',
            },
            {
              question: 'Mika on "desk" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'pulpetti',
              explanation: 'Desk on pulpetti. Se liittyy paikkaan, jossa oppilas kirjoittaa.',
            },
            {
              question: 'Mika on "eraser" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'pyyhekumi',
              explanation: 'Eraser tarkoittaa pyyhekumia. Se auttaa korjaamaan kirjoitusvirheita.',
            },
            {
              question: 'Mika on "pencil" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kyna',
              explanation: 'Pencil on kyna. Muista, etta pen on usein kuulakarkikyna.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.6,
            pedagogicalQuality: 4.6,
            languageQuality: 4.8,
          },
          notes: 'Strict flashcard format holds for all items with clearer explanations.',
        },
      },
      openai: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mika on "book" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kirja',
              explanation: 'Book on kirja.',
            },
            {
              question: 'Mika on "chair" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'tuoli',
              explanation: 'Chair on tuoli.',
            },
            {
              question: 'Mika on "desk" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'pulpetti',
              explanation: 'Desk on pulpetti.',
            },
            {
              question: 'Mika on "eraser" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'pyyhekumi',
              explanation: 'Eraser on pyyhekumi.',
            },
            {
              question: 'Mika on "pencil" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kyna',
              explanation: 'Pencil on kyna.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.4,
            pedagogicalQuality: 4.2,
            languageQuality: 4.5,
          },
          notes: 'Contract-valid output, but pedagogical explanations are too minimal.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mika on "book" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kirja',
              explanation: 'Book tarkoittaa kirjaa. Yleinen virhe on sekoittaa se sanaan notebook.',
            },
            {
              question: 'Mika on "chair" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'tuoli',
              explanation: 'Chair on tuoli. Sana liittyy luokkatilaan ja koulusanastoon.',
            },
            {
              question: 'Mika on "desk" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'pulpetti',
              explanation: 'Desk tarkoittaa pulpettia. Pulpetti on paikka, jossa oppilas kirjoittaa.',
            },
            {
              question: 'Mika on "eraser" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'pyyhekumi',
              explanation: 'Eraser on pyyhekumi. Se liittyy kirjoittamisen korjaamiseen.',
            },
            {
              question: 'Mika on "pencil" suomeksi?',
              type: 'flashcard',
              topic: 'Sanasto',
              subtopic: 'Koulu',
              correct_answer: 'kyna',
              explanation: 'Pencil tarkoittaa kynaa. Se eroaa sanasta pen, joka on usein kuulakarkikyna.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.6,
            pedagogicalQuality: 4.6,
            languageQuality: 4.7,
          },
          notes: 'Refactored prompt raises pedagogical depth while preserving strict format.',
        },
      },
    },
  },
  {
    id: 'flashcard-english-grade5-grammar',
    flow: 'flashcard_grammar',
    subject: 'englanti',
    grade: 5,
    material: 'Present simple and present continuous; common mistakes with he/she + verb endings.',
    expectedQualitativeOutcomes: [
      'cards focus on grammar rule recall, not passive recognition',
      'explanations point out common mistakes for grade 5',
      'examples stay short and understandable',
    ],
    providers: {
      anthropic: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mika verbin paate tulee he/she-muodossa present simple -ajassa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: '-s',
              explanation: 'He/she-muodossa verbiin tulee usein paate -s. Virhe on jattaa paate pois.',
            },
            {
              question: 'Kumpi muoto kuvaa tapahtumaa juuri nyt: present simple vai present continuous?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Aikamuodot',
              correct_answer: 'present continuous',
              explanation: 'Present continuous kuvaa tapahtumaa juuri nyt.',
            },
            {
              question: 'Mika apuverbi kaytetaan present continuous -muodossa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: 'to be',
              explanation: 'Present continuous rakentuu verbista to be ja -ing-muodosta.',
            },
            {
              question: 'Miksi lause "She play football" on vaarin?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: 'verbin -s puuttuu',
              explanation: 'She-muodossa verbiin tulee -s, joten oikea on "She plays football".',
            },
            {
              question: 'Mika paate tulee verbiin present continuous -muodossa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: '-ing',
              explanation: 'Verbista kaytetaan -ing-muotoa, kuten play -> playing.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.7,
            pedagogicalQuality: 4.6,
            languageQuality: 4.7,
          },
          notes: 'Strong baseline quality, some cards could highlight mistakes more consistently.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mika paate lisataan verbiin he/she-muodossa present simple -ajassa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: '-s',
              explanation: 'He/she-muodossa verbiin lisataan yleensa -s. Tavallinen virhe on unohtaa paate kokonaan.',
            },
            {
              question: 'Kumpi aikamuoto kuvaa tapahtumaa juuri nyt?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Aikamuodot',
              correct_answer: 'present continuous',
              explanation: 'Present continuous kuvaa nyt tapahtuvaa toimintaa. Present simple taas kuvaa usein tapaa tai toistuvaa tekemista.',
            },
            {
              question: 'Mika rakenne muodostaa present continuous -lauseen?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: 'to be + verbi-ing',
              explanation: 'Rakenne on to be + verbin -ing-muoto. Virhe on kayttaa pelkkaa -ing-verbi ilman to be -apuverbia.',
            },
            {
              question: 'Miksi lause "She play football" on vaarin?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: 'verbin -s puuttuu',
              explanation: 'She on kolmannen persoonan yksikko, joten verbiin lisataan -s: "She plays football".',
            },
            {
              question: 'Mika paate tulee paaverbiin present continuous -ajassa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: '-ing',
              explanation: 'Present continuous -muodossa paaverbi saa -ing-paatteen, esimerkiksi read -> reading.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.8,
            pedagogicalQuality: 4.8,
            languageQuality: 4.8,
          },
          notes: 'Refactored prompt improved consistency in mistake-focused explanations.',
        },
      },
      openai: {
        baseline: {
          promptVersion: 'baseline_pre_refactor',
          output: toJson([
            {
              question: 'Mika paate tulee he/she-muodossa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: '-s',
              explanation: 'He/she saa usein -s-paatteen.',
            },
            {
              question: 'Kumpi kuvaa nyt tapahtuvaa tekemista?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Aikamuodot',
              correct_answer: 'present continuous',
              explanation: 'Present continuous kuvaa nyt tekemista.',
            },
            {
              question: 'Mika apuverbi tarvitaan present continuous -muodossa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: 'to be',
              explanation: 'Tarvitaan to be -apuverbi.',
            },
            {
              question: 'Miksi "She play" on vaarin?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: 's puuttuu',
              explanation: 'She-muodossa verbiin tulee -s.',
            },
            {
              question: 'Mika paate tulee verbiin present continuous -muodossa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: '-ing',
              explanation: 'Verbiin tulee -ing.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.4,
            pedagogicalQuality: 4.2,
            languageQuality: 4.5,
          },
          notes: 'Grammar intent is present but explanations are too terse for stable pedagogy.',
        },
        refactored: {
          promptVersion: 'refactored_provider_neutral',
          output: toJson([
            {
              question: 'Mika paate lisataan verbiin he/she-muodossa present simple -ajassa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: '-s',
              explanation: 'He/she-muodossa verbi saa usein -s-paatteen. Virhe on unohtaa paate kokonaan.',
            },
            {
              question: 'Kumpi aikamuoto kuvaa juuri nyt tapahtuvaa toimintaa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Aikamuodot',
              correct_answer: 'present continuous',
              explanation: 'Present continuous kuvaa nyt tapahtuvaa tekemista. Present simple kuvaa usein toistuvaa tekemista.',
            },
            {
              question: 'Mika rakenne tarvitaan present continuous -lauseessa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: 'to be + verbi-ing',
              explanation: 'Tarvitaan to be + verbin -ing-muoto. Virhe on kayttaa vain paaverbia ilman apuverbia.',
            },
            {
              question: 'Miksi lause "She play" on vaarin?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present simple',
              correct_answer: 'verbin -s puuttuu',
              explanation: 'She on kolmannen persoonan yksikko, joten verbiin lisataan -s.',
            },
            {
              question: 'Mika paate tulee paaverbiin present continuous -ajassa?',
              type: 'flashcard',
              topic: 'Kielioppi',
              subtopic: 'Present continuous',
              correct_answer: '-ing',
              explanation: 'Present continuous -muodossa paaverbi saa -ing-paatteen, kuten read -> reading.',
            },
          ]),
          rubric: {
            schemaAdherence: 4.9,
            topicQuality: 4.7,
            pedagogicalQuality: 4.7,
            languageQuality: 4.7,
          },
          notes: 'Refactored prompt closes pedagogical gap with anthropic for grammar cards.',
        },
      },
    },
  },
];
